var x0=Object.defineProperty;var l=(z,J)=>{for(var Y in J)x0(z,Y,{get:J[Y],enumerable:!0,configurable:!0,set:(Q)=>J[Y]=()=>Q})};var d=(z,J)=>()=>(z&&(J=z(z=0)),J);var P={};l(P,{setApiKey:()=>f,hasApiKey:()=>C,getLogs:()=>m,getApiKey:()=>S,clearLogs:()=>O,clearApiKey:()=>R,addLog:()=>E0});function S(){return localStorage.getItem("vibe_gemini_api_key")}function f(z){localStorage.setItem("vibe_gemini_api_key",z)}function R(){localStorage.removeItem("vibe_gemini_api_key")}function C(){return!!S()}function m(){let z=localStorage.getItem(h);return z?JSON.parse(z):[]}function E0(z){let J=m();J.unshift(z),localStorage.setItem(h,JSON.stringify(J))}function O(){localStorage.removeItem(h)}var h="vibe_calorie_logs";class W0{constructor(z,J,Y,Q,X){this.model=z,this.task=J,this.apiKey=Y,this.stream=Q,this.requestOptions=X}toString(){var z,J;let Y=((z=this.requestOptions)===null||z===void 0?void 0:z.apiVersion)||K0,X=`${((J=this.requestOptions)===null||J===void 0?void 0:J.baseUrl)||S0}/${Y}/${this.model}:${this.task}`;if(this.stream)X+="?alt=sse";return X}}function b0(z){let J=[];if(z===null||z===void 0?void 0:z.apiClient)J.push(z.apiClient);return J.push(`${I0}/${A0}`),J.join(" ")}async function G0(z){var J;let Y=new Headers;Y.append("Content-Type","application/json"),Y.append("x-goog-api-client",b0(z.requestOptions)),Y.append("x-goog-api-key",z.apiKey);let Q=(J=z.requestOptions)===null||J===void 0?void 0:J.customHeaders;if(Q){if(!(Q instanceof Headers))try{Q=new Headers(Q)}catch(X){throw new L(`unable to convert customHeaders value ${JSON.stringify(Q)} to Headers: ${X.message}`)}for(let[X,Z]of Q.entries()){if(X==="x-goog-api-key")throw new L(`Cannot set reserved header name ${X}`);else if(X==="x-goog-api-client")throw new L(`Header name ${X} can only be set using the apiClient field`);Y.append(X,Z)}}return Y}async function f0(z,J,Y,Q,X,Z){let $=new W0(z,J,Y,Q,Z);return{url:$.toString(),fetchOptions:Object.assign(Object.assign({},R0(Z)),{method:"POST",headers:await G0($),body:X})}}async function G(z,J,Y,Q,X,Z={},$=fetch){let{url:D,fetchOptions:W}=await f0(z,J,Y,Q,X,Z);return y0(D,W,$)}async function y0(z,J,Y=fetch){let Q;try{Q=await Y(z,J)}catch(X){k0(X,z)}if(!Q.ok)await v0(Q,z);return Q}function k0(z,J){let Y=z;if(Y.name==="AbortError")Y=new q(`Request aborted when fetching ${J.toString()}: ${z.message}`),Y.stack=z.stack;else if(!(z instanceof g||z instanceof L))Y=new j(`Error fetching from ${J.toString()}: ${z.message}`),Y.stack=z.stack;throw Y}async function v0(z,J){let Y="",Q;try{let X=await z.json();if(Y=X.error.message,X.error.details)Y+=` ${JSON.stringify(X.error.details)}`,Q=X.error.details}catch(X){}throw new g(`Error fetching from ${J.toString()}: [${z.status} ${z.statusText}] ${Y}`,z.status,z.statusText,Q)}function R0(z){let J={};if((z===null||z===void 0?void 0:z.signal)!==void 0||(z===null||z===void 0?void 0:z.timeout)>=0){let Y=new AbortController;if((z===null||z===void 0?void 0:z.timeout)>=0)setTimeout(()=>Y.abort(),z.timeout);if(z===null||z===void 0?void 0:z.signal)z.signal.addEventListener("abort",()=>{Y.abort()});J.signal=Y.signal}return J}function c(z){return z.text=()=>{if(z.candidates&&z.candidates.length>0){if(z.candidates.length>1)console.warn(`This response had ${z.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`);if(y(z.candidates[0]))throw new x(`${M(z)}`,z);return C0(z)}else if(z.promptFeedback)throw new x(`Text not available. ${M(z)}`,z);return""},z.functionCall=()=>{if(z.candidates&&z.candidates.length>0){if(z.candidates.length>1)console.warn(`This response had ${z.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`);if(y(z.candidates[0]))throw new x(`${M(z)}`,z);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Q0(z)[0]}else if(z.promptFeedback)throw new x(`Function call not available. ${M(z)}`,z);return},z.functionCalls=()=>{if(z.candidates&&z.candidates.length>0){if(z.candidates.length>1)console.warn(`This response had ${z.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`);if(y(z.candidates[0]))throw new x(`${M(z)}`,z);return Q0(z)}else if(z.promptFeedback)throw new x(`Function call not available. ${M(z)}`,z);return},z}function C0(z){var J,Y,Q,X;let Z=[];if((Y=(J=z.candidates)===null||J===void 0?void 0:J[0].content)===null||Y===void 0?void 0:Y.parts)for(let $ of(X=(Q=z.candidates)===null||Q===void 0?void 0:Q[0].content)===null||X===void 0?void 0:X.parts){if($.text)Z.push($.text);if($.executableCode)Z.push("\n```"+$.executableCode.language+`
`+$.executableCode.code+"\n```\n");if($.codeExecutionResult)Z.push("\n```\n"+$.codeExecutionResult.output+"\n```\n")}if(Z.length>0)return Z.join("");else return""}function Q0(z){var J,Y,Q,X;let Z=[];if((Y=(J=z.candidates)===null||J===void 0?void 0:J[0].content)===null||Y===void 0?void 0:Y.parts){for(let $ of(X=(Q=z.candidates)===null||Q===void 0?void 0:Q[0].content)===null||X===void 0?void 0:X.parts)if($.functionCall)Z.push($.functionCall)}if(Z.length>0)return Z;else return}function y(z){return!!z.finishReason&&h0.includes(z.finishReason)}function M(z){var J,Y,Q;let X="";if((!z.candidates||z.candidates.length===0)&&z.promptFeedback){if(X+="Response was blocked",(J=z.promptFeedback)===null||J===void 0?void 0:J.blockReason)X+=` due to ${z.promptFeedback.blockReason}`;if((Y=z.promptFeedback)===null||Y===void 0?void 0:Y.blockReasonMessage)X+=`: ${z.promptFeedback.blockReasonMessage}`}else if((Q=z.candidates)===null||Q===void 0?void 0:Q[0]){let Z=z.candidates[0];if(y(Z)){if(X+=`Candidate was blocked due to ${Z.finishReason}`,Z.finishMessage)X+=`: ${Z.finishMessage}`}}return X}function I(z){return this instanceof I?(this.v=z,this):new I(z)}function O0(z,J,Y){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var Q=Y.apply(z,J||[]),X,Z=[];return X={},$("next"),$("throw"),$("return"),X[Symbol.asyncIterator]=function(){return this},X;function $(V){if(Q[V])X[V]=function(B){return new Promise(function(H,w0){Z.push([V,B,H,w0])>1||D(V,B)})}}function D(V,B){try{W(Q[V](B))}catch(H){F(Z[0][3],H)}}function W(V){V.value instanceof I?Promise.resolve(V.value.v).then(N,E):F(Z[0][2],V)}function N(V){D("next",V)}function E(V){D("throw",V)}function F(V,B){if(V(B),Z.shift(),Z.length)D(Z[0][0],Z[0][1])}}function P0(z){let J=z.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),Y=q0(J),[Q,X]=Y.tee();return{stream:g0(Q),response:_0(X)}}async function _0(z){let J=[],Y=z.getReader();while(!0){let{done:Q,value:X}=await Y.read();if(Q)return c(c0(J));J.push(X)}}function g0(z){return O0(this,arguments,function*(){let Y=z.getReader();while(!0){let{value:Q,done:X}=yield I(Y.read());if(X)break;yield yield I(c(Q))}})}function q0(z){let J=z.getReader();return new ReadableStream({start(Q){let X="";return Z();function Z(){return J.read().then(({value:$,done:D})=>{if(D){if(X.trim()){Q.error(new j("Failed to parse stream"));return}Q.close();return}X+=$;let W=X.match(X0),N;while(W){try{N=JSON.parse(W[1])}catch(E){Q.error(new j(`Error parsing JSON response: "${W[1]}"`));return}Q.enqueue(N),X=X.substring(W[0].length),W=X.match(X0)}return Z()}).catch(($)=>{let D=$;if(D.stack=$.stack,D.name==="AbortError")D=new q("Request aborted when reading from the stream");else D=new j("Error reading from the stream");throw D})}}})}function c0(z){let J=z[z.length-1],Y={promptFeedback:J===null||J===void 0?void 0:J.promptFeedback};for(let Q of z){if(Q.candidates){let X=0;for(let Z of Q.candidates){if(!Y.candidates)Y.candidates=[];if(!Y.candidates[X])Y.candidates[X]={index:X};if(Y.candidates[X].citationMetadata=Z.citationMetadata,Y.candidates[X].groundingMetadata=Z.groundingMetadata,Y.candidates[X].finishReason=Z.finishReason,Y.candidates[X].finishMessage=Z.finishMessage,Y.candidates[X].safetyRatings=Z.safetyRatings,Z.content&&Z.content.parts){if(!Y.candidates[X].content)Y.candidates[X].content={role:Z.content.role||"user",parts:[]};let $={};for(let D of Z.content.parts){if(D.text)$.text=D.text;if(D.functionCall)$.functionCall=D.functionCall;if(D.executableCode)$.executableCode=D.executableCode;if(D.codeExecutionResult)$.codeExecutionResult=D.codeExecutionResult;if(Object.keys($).length===0)$.text="";Y.candidates[X].content.parts.push($)}}}X++}if(Q.usageMetadata)Y.usageMetadata=Q.usageMetadata}return Y}async function B0(z,J,Y,Q){let X=await G(J,T.STREAM_GENERATE_CONTENT,z,!0,JSON.stringify(Y),Q);return P0(X)}async function j0(z,J,Y,Q){let Z=await(await G(J,T.GENERATE_CONTENT,z,!1,JSON.stringify(Y),Q)).json();return{response:c(Z)}}function N0(z){if(z==null)return;else if(typeof z==="string")return{role:"system",parts:[{text:z}]};else if(z.text)return{role:"system",parts:[z]};else if(z.parts)if(!z.role)return{role:"system",parts:z.parts};else return z}function b(z){let J=[];if(typeof z==="string")J=[{text:z}];else for(let Y of z)if(typeof Y==="string")J.push({text:Y});else J.push(Y);return u0(J)}function u0(z){let J={role:"user",parts:[]},Y={role:"function",parts:[]},Q=!1,X=!1;for(let Z of z)if("functionResponse"in Z)Y.parts.push(Z),X=!0;else J.parts.push(Z),Q=!0;if(Q&&X)throw new j("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!Q&&!X)throw new j("No content is provided for sending chat message.");if(Q)return J;return Y}function i0(z,J){var Y;let Q={model:J===null||J===void 0?void 0:J.model,generationConfig:J===null||J===void 0?void 0:J.generationConfig,safetySettings:J===null||J===void 0?void 0:J.safetySettings,tools:J===null||J===void 0?void 0:J.tools,toolConfig:J===null||J===void 0?void 0:J.toolConfig,systemInstruction:J===null||J===void 0?void 0:J.systemInstruction,cachedContent:(Y=J===null||J===void 0?void 0:J.cachedContent)===null||Y===void 0?void 0:Y.name,contents:[]},X=z.generateContentRequest!=null;if(z.contents){if(X)throw new L("CountTokensRequest must have one of contents or generateContentRequest, not both.");Q.contents=z.contents}else if(X)Q=Object.assign(Object.assign({},Q),z.generateContentRequest);else{let Z=b(z);Q.contents=[Z]}return{generateContentRequest:Q}}function Z0(z){let J;if(z.contents)J=z;else J={contents:[b(z)]};if(z.systemInstruction)J.systemInstruction=N0(z.systemInstruction);return J}function l0(z){if(typeof z==="string"||Array.isArray(z))return{content:b(z)};return z}function m0(z){let J=!1;for(let Y of z){let{role:Q,parts:X}=Y;if(!J&&Q!=="user")throw new j(`First content should be with role 'user', got ${Q}`);if(!a.includes(Q))throw new j(`Each item should include role field. Got ${Q} but valid roles are: ${JSON.stringify(a)}`);if(!Array.isArray(X))throw new j("Content should have 'parts' property with an array of Parts");if(X.length===0)throw new j("Each Content should have at least one part");let Z={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let D of X)for(let W of $0)if(W in D)Z[W]+=1;let $=d0[Q];for(let D of $0)if(!$.includes(D)&&Z[D]>0)throw new j(`Content with role '${Q}' can't contain '${D}' part`);J=!0}}function D0(z){var J;if(z.candidates===void 0||z.candidates.length===0)return!1;let Y=(J=z.candidates[0])===null||J===void 0?void 0:J.content;if(Y===void 0)return!1;if(Y.parts===void 0||Y.parts.length===0)return!1;for(let Q of Y.parts){if(Q===void 0||Object.keys(Q).length===0)return!1;if(Q.text!==void 0&&Q.text==="")return!1}return!0}class L0{constructor(z,J,Y,Q={}){if(this.model=J,this.params=Y,this._requestOptions=Q,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=z,Y===null||Y===void 0?void 0:Y.history)m0(Y.history),this._history=Y.history}async getHistory(){return await this._sendPromise,this._history}async sendMessage(z,J={}){var Y,Q,X,Z,$,D;await this._sendPromise;let W=b(z),N={safetySettings:(Y=this.params)===null||Y===void 0?void 0:Y.safetySettings,generationConfig:(Q=this.params)===null||Q===void 0?void 0:Q.generationConfig,tools:(X=this.params)===null||X===void 0?void 0:X.tools,toolConfig:(Z=this.params)===null||Z===void 0?void 0:Z.toolConfig,systemInstruction:($=this.params)===null||$===void 0?void 0:$.systemInstruction,cachedContent:(D=this.params)===null||D===void 0?void 0:D.cachedContent,contents:[...this._history,W]},E=Object.assign(Object.assign({},this._requestOptions),J),F;return this._sendPromise=this._sendPromise.then(()=>j0(this._apiKey,this.model,N,E)).then((V)=>{var B;if(D0(V.response)){this._history.push(W);let H=Object.assign({parts:[],role:"model"},(B=V.response.candidates)===null||B===void 0?void 0:B[0].content);this._history.push(H)}else{let H=M(V.response);if(H)console.warn(`sendMessage() was unsuccessful. ${H}. Inspect response object for details.`)}F=V}).catch((V)=>{throw this._sendPromise=Promise.resolve(),V}),await this._sendPromise,F}async sendMessageStream(z,J={}){var Y,Q,X,Z,$,D;await this._sendPromise;let W=b(z),N={safetySettings:(Y=this.params)===null||Y===void 0?void 0:Y.safetySettings,generationConfig:(Q=this.params)===null||Q===void 0?void 0:Q.generationConfig,tools:(X=this.params)===null||X===void 0?void 0:X.tools,toolConfig:(Z=this.params)===null||Z===void 0?void 0:Z.toolConfig,systemInstruction:($=this.params)===null||$===void 0?void 0:$.systemInstruction,cachedContent:(D=this.params)===null||D===void 0?void 0:D.cachedContent,contents:[...this._history,W]},E=Object.assign(Object.assign({},this._requestOptions),J),F=B0(this._apiKey,this.model,N,E);return this._sendPromise=this._sendPromise.then(()=>F).catch((V)=>{throw Error(V0)}).then((V)=>V.response).then((V)=>{if(D0(V)){this._history.push(W);let B=Object.assign({},V.candidates[0].content);if(!B.role)B.role="model";this._history.push(B)}else{let B=M(V);if(B)console.warn(`sendMessageStream() was unsuccessful. ${B}. Inspect response object for details.`)}}).catch((V)=>{if(V.message!==V0)console.error(V)}),F}}async function p0(z,J,Y,Q){return(await G(J,T.COUNT_TOKENS,z,!1,JSON.stringify(Y),Q)).json()}async function n0(z,J,Y,Q){return(await G(J,T.EMBED_CONTENT,z,!1,JSON.stringify(Y),Q)).json()}async function o0(z,J,Y,Q){let X=Y.requests.map(($)=>{return Object.assign(Object.assign({},$),{model:J})});return(await G(J,T.BATCH_EMBED_CONTENTS,z,!1,JSON.stringify({requests:X}),Q)).json()}class _{constructor(z,J,Y={}){if(this.apiKey=z,this._requestOptions=Y,J.model.includes("/"))this.model=J.model;else this.model=`models/${J.model}`;this.generationConfig=J.generationConfig||{},this.safetySettings=J.safetySettings||[],this.tools=J.tools,this.toolConfig=J.toolConfig,this.systemInstruction=N0(J.systemInstruction),this.cachedContent=J.cachedContent}async generateContent(z,J={}){var Y;let Q=Z0(z),X=Object.assign(Object.assign({},this._requestOptions),J);return j0(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(Y=this.cachedContent)===null||Y===void 0?void 0:Y.name},Q),X)}async generateContentStream(z,J={}){var Y;let Q=Z0(z),X=Object.assign(Object.assign({},this._requestOptions),J);return B0(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(Y=this.cachedContent)===null||Y===void 0?void 0:Y.name},Q),X)}startChat(z){var J;return new L0(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(J=this.cachedContent)===null||J===void 0?void 0:J.name},z),this._requestOptions)}async countTokens(z,J={}){let Y=i0(z,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),Q=Object.assign(Object.assign({},this._requestOptions),J);return p0(this.apiKey,this.model,Y,Q)}async embedContent(z,J={}){let Y=l0(z),Q=Object.assign(Object.assign({},this._requestOptions),J);return n0(this.apiKey,this.model,Y,Q)}async batchEmbedContents(z,J={}){let Y=Object.assign(Object.assign({},this._requestOptions),J);return o0(this.apiKey,this.model,z,Y)}}class u{constructor(z){this.apiKey=z}getGenerativeModel(z,J){if(!z.model)throw new j("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new _(this.apiKey,z,J)}getGenerativeModelFromCachedContent(z,J,Y){if(!z.name)throw new L("Cached content must contain a `name` field.");if(!z.model)throw new L("Cached content must contain a `model` field.");let Q=["model","systemInstruction"];for(let Z of Q)if((J===null||J===void 0?void 0:J[Z])&&z[Z]&&(J===null||J===void 0?void 0:J[Z])!==z[Z]){if(Z==="model"){let $=J.model.startsWith("models/")?J.model.replace("models/",""):J.model,D=z.model.startsWith("models/")?z.model.replace("models/",""):z.model;if($===D)continue}throw new L(`Different value for "${Z}" specified in modelParams (${J[Z]}) and cachedContent (${z[Z]})`)}let X=Object.assign(Object.assign({},J),{model:z.model,tools:z.tools,toolConfig:z.toolConfig,systemInstruction:z.systemInstruction,cachedContent:z});return new _(this.apiKey,X,Y)}}var p,n,o,a,t,r,s,e,A,z0,J0,Y0,j,x,g,L,q,S0="https://generativelanguage.googleapis.com",K0="v1beta",A0="0.24.1",I0="genai-js",T,h0,X0,$0,d0,V0="SILENT_ERROR";var U0=d(()=>{(function(z){z.STRING="string",z.NUMBER="number",z.INTEGER="integer",z.BOOLEAN="boolean",z.ARRAY="array",z.OBJECT="object"})(p||(p={}));(function(z){z.LANGUAGE_UNSPECIFIED="language_unspecified",z.PYTHON="python"})(n||(n={}));(function(z){z.OUTCOME_UNSPECIFIED="outcome_unspecified",z.OUTCOME_OK="outcome_ok",z.OUTCOME_FAILED="outcome_failed",z.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(o||(o={}));a=["user","model","function","system"];(function(z){z.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",z.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",z.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",z.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",z.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",z.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(t||(t={}));(function(z){z.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",z.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",z.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",z.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",z.BLOCK_NONE="BLOCK_NONE"})(r||(r={}));(function(z){z.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",z.NEGLIGIBLE="NEGLIGIBLE",z.LOW="LOW",z.MEDIUM="MEDIUM",z.HIGH="HIGH"})(s||(s={}));(function(z){z.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",z.SAFETY="SAFETY",z.OTHER="OTHER"})(e||(e={}));(function(z){z.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",z.STOP="STOP",z.MAX_TOKENS="MAX_TOKENS",z.SAFETY="SAFETY",z.RECITATION="RECITATION",z.LANGUAGE="LANGUAGE",z.BLOCKLIST="BLOCKLIST",z.PROHIBITED_CONTENT="PROHIBITED_CONTENT",z.SPII="SPII",z.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",z.OTHER="OTHER"})(A||(A={}));(function(z){z.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",z.RETRIEVAL_QUERY="RETRIEVAL_QUERY",z.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",z.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",z.CLASSIFICATION="CLASSIFICATION",z.CLUSTERING="CLUSTERING"})(z0||(z0={}));(function(z){z.MODE_UNSPECIFIED="MODE_UNSPECIFIED",z.AUTO="AUTO",z.ANY="ANY",z.NONE="NONE"})(J0||(J0={}));(function(z){z.MODE_UNSPECIFIED="MODE_UNSPECIFIED",z.MODE_DYNAMIC="MODE_DYNAMIC"})(Y0||(Y0={}));j=class j extends Error{constructor(z){super(`[GoogleGenerativeAI Error]: ${z}`)}};x=class x extends j{constructor(z,J){super(z);this.response=J}};g=class g extends j{constructor(z,J,Y,Q){super(z);this.status=J,this.statusText=Y,this.errorDetails=Q}};L=class L extends j{};q=class q extends j{};(function(z){z.GENERATE_CONTENT="generateContent",z.STREAM_GENERATE_CONTENT="streamGenerateContent",z.COUNT_TOKENS="countTokens",z.EMBED_CONTENT="embedContent",z.BATCH_EMBED_CONTENTS="batchEmbedContents"})(T||(T={}));h0=[A.RECITATION,A.SAFETY,A.LANGUAGE];X0=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;$0=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],d0={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]}});var F0={};l(F0,{analyzeImage:()=>a0});async function a0(z){let J=S();if(!J)throw Error("API Key not found. Please set it in settings.");let Q=new u(J).getGenerativeModel({model:"gemini-1.5-flash"}),X=await t0(z),Z=`
    Analyze this image of food. Identify the item and estimate the calories.
    Return ONLY a raw JSON object (no markdown, no backticks) with this structure:
    {
        "item": "Name of the food",
        "calories": 0,
        "protein": 0,
        "carbs": 0,
        "fat": 0,
        "confidence": 0.0 to 1.0
    }
    If it's not food, set confidence to 0.
    `;try{let N=(await(await Q.generateContent([Z,X])).response).text().replace(/```json/g,"").replace(/```/g,"").trim();return JSON.parse(N)}catch($){throw console.error("Gemini Analysis Error:",$),Error("Failed to analyze image. Please try again.")}}async function t0(z){return{inlineData:{data:await new Promise((Y)=>{let Q=new FileReader;Q.onloadend=()=>Y(Q.result.split(",")[1]),Q.readAsDataURL(z)}),mimeType:z.type}}}var H0=d(()=>{U0()});var w={loading:document.getElementById("loading"),onboarding:document.getElementById("onboarding-view"),tracker:document.getElementById("tracker-view")},i={saveKey:document.getElementById("save-key-btn"),settings:document.getElementById("settings-btn"),updateKey:document.getElementById("update-key-btn"),deleteData:document.getElementById("delete-data-btn"),camera:document.getElementById("camera-btn")},K={apiKey:document.getElementById("api-key-input"),settingsApiKey:document.getElementById("settings-api-key"),camera:document.getElementById("camera-input")},U={settings:document.getElementById("settings-dialog"),item:document.getElementById("item-dialog")},k={apiKey:S()};async function r0(){console.log("Vibe Calorie: Initializing..."),z4(),v()}function v(){setTimeout(()=>{if(w.loading?.classList.add("hidden"),C())s0();else e0()},500)}function s0(){w.onboarding?.classList.add("hidden"),w.tracker?.classList.remove("hidden")}function e0(){w.tracker?.classList.add("hidden"),w.onboarding?.classList.remove("hidden")}function z4(){i.saveKey?.addEventListener("click",()=>{let Y=K.apiKey.value.trim();if(Y)f(Y),k.apiKey=Y,v();else alert("Please enter a valid API key.")}),i.settings?.addEventListener("click",()=>{if(U.settings){if(K.settingsApiKey)K.settingsApiKey.value=k.apiKey||"";U.settings.showModal()}}),document.getElementById("update-key-btn")?.addEventListener("click",()=>{let Y=K.settingsApiKey?.value.trim();if(Y)f(Y),k.apiKey=Y,U.settings.close(),alert("API Key updated!"),v()}),document.getElementById("delete-data-btn")?.addEventListener("click",()=>{if(confirm("Are you sure you want to delete all data and reset?"))R(),O(),k.apiKey=null,U.settings.close(),v()}),U.settings?.addEventListener("click",(Y)=>{if(Y.target===U.settings)U.settings.close()}),i.camera?.addEventListener("click",()=>{K.camera.click()}),K.camera?.addEventListener("change",async(Y)=>{let Q=Y.target.files?.[0];if(Q){console.log("File selected:",Q.name),w.loading?.classList.remove("hidden");try{let{analyzeImage:X}=await Promise.resolve().then(() => (H0(),F0)),Z=await X(Q);console.log("Analysis Result:",Z);let $=document.getElementById("detail-content"),D=document.getElementById("detail-title");if(D)D.innerText=Z.item;if($)$.innerHTML=`
                        <div class="result-card">
                            <p class="cals-big">${Z.calories} <span class="unit">kcal</span></p>
                            <div class="macros">
                                <span>P: ${Z.protein}g</span>
                                <span>C: ${Z.carbs}g</span>
                                <span>F: ${Z.fat}g</span>
                            </div>
                            <p class="confidence">Confidence: ${Math.round(Z.confidence*100)}%</p>
                        </div>
                        <button id="add-log-btn" class="primary-btn">Add to Log</button>
                    `,document.getElementById("add-log-btn")?.addEventListener("click",async()=>{let{addLog:W}=await Promise.resolve().then(() => P);W({id:Date.now().toString(),name:Z.item,calories:Z.calories,timestamp:Date.now(),image:await J4(Q)}),U.item.close(),M0()});w.loading?.classList.add("hidden"),U.item.showModal()}catch(X){console.error(X),w.loading?.classList.add("hidden"),alert(X.message||"Failed to analyze image.")}}})}async function J4(z){return new Promise((J,Y)=>{let Q=new FileReader;Q.readAsDataURL(z),Q.onload=()=>J(Q.result),Q.onerror=(X)=>Y(X)})}async function M0(){let{getLogs:z}=await Promise.resolve().then(() => P),J=z(),Y=document.getElementById("feed");if(!Y)return;if(Y.innerHTML="",J.length===0){Y.innerHTML=`
            <div class="empty-state">
                <div class="emoji">\uD83D\uDCF8</div>
                <p>No vibes yet. Snap a meal!</p>
            </div>
        `;return}J.forEach((Q)=>{let X=document.createElement("div");X.className="feed-item",X.innerHTML=`
            <img src="${Q.image||""}" class="feed-img" alt="${Q.name}">
            <div class="feed-content">
                <h3 class="feed-title">${Q.name}</h3>
                <p class="feed-cals">${new Date(Q.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}</p>
            </div>
            <div class="cals-badge">${Q.calories}</div>
        `,Y.appendChild(X)})}M0();if("serviceWorker"in navigator)window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then((z)=>{console.log("SW registered: ",z)}).catch((z)=>{console.log("SW registration failed: ",z)})});document.addEventListener("DOMContentLoaded",r0);
